# Kh·∫£o s√°t k·∫øt c·ª•c l√† t·ª∑ l·ªá: H·ªìi quy Binomial

## Gi·ªõi thi·ªáu

Nh·ªØng nghi√™n c·ª©u v·ªÅ quy tr√¨nh th·ª• tinh ·ªëng nghi·ªám ƒë·∫∑t ra y√™u c·∫ßu kh·∫£o s√°t nhi·ªÅu lo·∫°i k·∫øt c·ª•c l√¢m s√†ng v·ªõi b·∫£n ch·∫•t kh√°c nhau. M·∫∑t kh√°c, c√≥ t√≠nh ch·∫•t k·∫ø th·ª´a trong chu·ªói k·∫øt qu·∫£ c·ªßa quy tr√¨nh. Th√†nh ph·∫©m thu ƒë∆∞·ª£c c·ªßa c√¥ng ƒëo·∫°n sau ch√≠nh l√† h·ªá qu·∫£ t·ª´ vi·ªác ti·∫øn h√†nh m·ªôt lo·∫°t ph√©p th·ª≠ (th√≠ d·ª• th·ª• tinh, chuy·ªÉn ph√¥i...) tr√™n t·∫≠p h·ª£p k·∫øt qu·∫£ c√¥ng ƒëo·∫°n tr∆∞·ªõc. Th√≠ d·ª•, s·ªë l∆∞·ª£ng ph√¥i l√† h·ªá qu·∫£ t·ª´ t·ª∑ l·ªá th·ª• tinh th√†nh c√¥ng tr√™n t·∫≠p h·ª£p nhi·ªÅu no√£n. Do ƒë√≥, c√πng m·ªôt th·ª±c th·ªÉ k·∫øt c·ª•c nh∆∞ng c√≥ th·ªÉ ƒë∆∞·ª£c di·ªÖn ƒë·∫°t theo nhi·ªÅu c√°ch; s·ªë l∆∞·ª£ng ph√¥i, t·ª∑ l·ªá th·ª• tinh tr√™n t·ªïng s·ªë no√£n, x√°c su·∫•t th·ª• tinh th√†nh c√¥ng cho m·ªói no√£n... 

Nh∆∞ ƒë√£ b√†n trong ch∆∞∆°ng 3, do gi·ªõi h·∫°n v·ªÅ c√¥ng c·ª• th·ªëng k√™, h·∫ßu h·∫øt nh·ªØng nghi√™n c·ª©u v·ªÅ h·ªó tr·ª£ sinh s·∫£n hi·ªán nay ch·ªâ m·ªõi d·ª´ng l·∫°i ·ªü ph√¢n t√≠ch so s√°nh v√† ki·ªÉm ƒë·ªãnh b·∫±ng nh·ªØng ph√©p ki·ªÉm ƒë∆°n gi·∫£n th√¥ s∆° nh∆∞ Mann-Whitney, Student t test... cho m·ªçi k·∫øt qu·∫£ l√† con s·ªë, kh√¥ng ph√¢n bi·ªát b·∫£n ch·∫•t c·ªßa ch√∫ng l√† s·ªë ƒë·∫øm, s·ªë li√™n t·ª•c hay t·ª∑ l·ªá. 

Trong ch∆∞∆°ng n√†y, ch√∫ng t√¥i gi·ªõi thi·ªáu m·ªôt ph∆∞∆°ng ph√°p ph√¢n t√≠ch h·ª£p l√Ω v√† ch√≠nh x√°c h∆°n cho k·∫øt c·ª•c l√† t·ª∑ l·ªá, √°p d·ª•ng l√Ω thuy·∫øt x√°c su·∫•t cho bi·∫øn r·ªùi r·∫°c v√† m√¥ h√¨nh h·ªìi quy tuy·∫øn t√≠nh t·ªïng qu√°t v·ªõi ph√¢n ph·ªëi nh·ªã th·ª©c (Binomial).

## B·ªëi c·∫£nh c·ªßa th√≠ nghi·ªám

K√≠ch ho·∫°t s·ª± tr∆∞·ªüng th√†nh c·ªßa no√£n l√† m·ªôt c√¥ng ƒëo·∫°n v√†o cu·ªëi chu k·ª≥ k√≠ch th√≠ch bu·ªìng tr·ª©ng. Hormone hCG th∆∞·ªùng ƒë∆∞·ª£c d√πng ƒë·ªÉ t·∫°o ƒë·ªânh hormone ho√†ng th·ªÉ (LH) ·ªü cu·ªëi c√°c chu k·ª≥ KTBT nh·∫±m kh·ªüi ƒë·ªông s·ª± tr∆∞·ªüng th√†nh no√£n v√† ti·∫øp t·ª•c ho√†n ch·ªânh ti·∫øn tr√¨nh gi·∫£m ph√¢n ƒë√£ b·ªã gi√°n ƒëo·∫°n tr∆∞·ªõc ƒë√≥. Tuy nhi√™n vi·ªác s·ª≠ d·ª•ng hCG c√≥ th·ªÉ l√†m tƒÉng nguy c∆° qu√° k√≠ch bu·ªìng tr·ª©ng (OHSS). M·ªôt ph∆∞∆°ng ph√°p kh√°c l√† s·ª≠ d·ª•ng ch·∫•t ƒë·ªìng v·∫≠n GnRH cho ph√©p gi·∫£i ph√≥ng c·∫•p t√≠nh LH v√† hormone k√≠ch th√≠ch nang no√£n (FSH), kh·ªüi ph√°t ti·∫øn tr√¨nh r·ª•ng tr·ª©ng. Qu√° tr√¨nh k√≠ch ho·∫°t t·∫°o 2 ƒë·ªânh LH v√† FSH n√†y kh√° t∆∞∆°ng ƒë·ªìng v·ªõi c√°c chu k·ª≥ t·ª± nhi√™n, nh∆∞ng v·ªõi n·ªìng ƒë·ªô th·∫•p h∆°n v√† th·ªùi gian b√°n hu·ª∑ ng·∫Øn h∆°n, g√≥p ph·∫ßn l√†m gi·∫£m nguy c∆° OHSS. G·∫ßn ƒë√¢y, ta c√≥ th√™m l·ª±a ch·ªçn kh√°c l√† ph√°c ƒë·ªì k√≠ch ho·∫°t k√©p (Dual trigger). Ph√°c ƒë·ªì n√†y s·ª≠ d·ª•ng ƒë·ªìng th·ªùi ch·∫•t ch·ªß v·∫≠n GnRH v√† b·ªï sung hCG ·ªü li·ªÅu th·∫•p ho·∫∑c ti√™u chu·∫©n ƒë·ªÉ kh·ªüi ph√°t tr∆∞·ªüng th√†nh no√£n v√† r·ª•ng tr·ª©ng.

Trong th√≠ nghi·ªám n√†y, m·ªôt nh√≥m nghi√™n c·ª©u mu·ªën kh·∫£o s√°t hi·ªáu qu·∫£ t·∫°o ph√¥i (blastocytes) c·ªßa k·ªπ thu·∫≠t k√≠ch th√≠ch tr∆∞·ªüng th√†nh no√£n k√©p (Dual trigger), so v·ªõi 2 k·ªπ thu·∫≠t tham chi·∫øu d√πng ƒë·ªìng v·∫≠n GnRH (GnRHa) v√† hCG ƒë∆°n gi·∫£n.

## C√¥ng c·ª• c·∫ßn thi·∫øt cho quy tr√¨nh

+ Th∆∞ vi·ªán dplyr trong h·ªá sinh th√°i tidyverse[@tidyverse] ƒë·ªÉ thao t√°c d·ªØ li·ªáu v√† th·ªëng k√™ m√¥ t·∫£

+ Th∆∞ vi·ªán ggplot2, ggrides[@ggridges], tidybayes v√† ggdist ƒë·ªÉ v·∫Ω m·ªôt s·ªë bi·ªÉu ƒë·ªì th·ªëng k√™;

+ Th∆∞ vi·ªán gamlss[@gamlss1] ƒë·ªÉ d·ª±ng m√¥ h√¨nh GLM v·ªõi ph√¢n ph·ªëi Binomial

+ Th∆∞ vi·ªán marginaleffects[@marginal] ƒë·ªÉ ∆∞·ªõc t√≠nh OR, RR v√† suy di·ªÖn th·ªëng k√™ t·ª´ k·∫øt qu·∫£ m√¥ h√¨nh.
```{r}
library(tidyverse)
library(ggridges)

library(gamlss)
library(marginaleffects)

library(tidybayes)
library(ggdist)
```

## Chu·∫©n b·ªã d·ªØ li·ªáu

ƒê·∫ßu ti√™n, ta t·∫£i d·ªØ li·ªáu t·ª´ file Dual_trigger.csv v√†o dataframe df b·∫±ng h√†m read.csv, sau ƒë√≥ √°p d·ª•ng h√†m factor ƒë·ªÉ chuy·ªÉn d·∫°ng bi·∫øn Trigger th√†nh s·ªë th·ª© t·ª± :

1 = a (GnRH agonist), 2 = d (Dual trigger), 3 = h (hCG).

Ta t·∫°o ra th√™m bi·∫øn p1 l√† t·ª∑ l·ªá t·∫°o blastocytes t·ª´ s·ªë no√£n ban ƒë·∫ßu, b·∫±ng c√°ch chia s·ªë l∆∞·ª£ng blastocytes (bi·∫øn blast) cho s·ªë no√£n (bi·∫øn oocytes).

```{r}
df = read.csv('Dual_trigger.csv', sep = ';', 
              dec = ',', 
              fileEncoding = 'UTF-8-BOM')%>%na.omit()

df$Trigger = factor(df$Trigger)
df$p1 = df$blast/df$oocytes

df%>%head()%>%knitr::kable()
```
## K·∫ø ho·∫°ch ph√¢n t√≠ch

Kh·∫£ nƒÉng t·∫°o blastocyte khi d√πng k·ªπ thu·∫≠t Dual trigger so v·ªõi 2 ph∆∞∆°ng ph√°p tham chi·∫øu (ƒë·ªìng v·∫≠n ho·∫∑c hCG ƒë∆°n) s·∫Ω ƒë∆∞·ª£c ∆∞·ªõc l∆∞·ª£ng b·∫±ng marginal Odds-ratio (OR) v√† risk-ratio (RR), c√≥ hi·ªáu ch·ªânh cho tu·ªïi v√† AFC, d·ª±a v√†o m·ªôt m√¥ h√¨nh h·ªìi quy tuy·∫øn t√≠nh t·ªïng qu√°t (GLM) v·ªõi ph√¢n ph·ªëi nh·ªã th·ª©c (Binomial). Suy di·ªÖn th·ªëng k√™ d·ª±a v√†o ph·ªß nh·∫≠n gi·∫£ thuy·∫øt v√¥ hi·ªáu (OR v√† RR = 1) ·ªü ng∆∞·ª°ng √Ω nghƒ©a p = 0.05.

## Th·ªëng k√™ m√¥ t·∫£

Ta k·∫øt h·ª£p h√†m group_by v√† summarize c·ªßa th∆∞ vi·ªán dplyr ƒë·ªÉ d·ª±ng m·ªôt b·∫£ng th·ªëng k√™ m√¥ t·∫£ ƒë∆°n gi·∫£n, tr√¨nh b√†y trung v·ªã, SD, ph√¢n v·ªã th·ª© 5 v√† 95 c·ªßa t·ª∑ l·ªá t·∫°o blastocytes (bi·∫øn p1) trong 3 ph√¢n nh√≥m k·ªπ thu·∫≠t trigger.

```{r}
df%>%group_by(Trigger)%>%
  summarize(n = n(),
            mean = mean(p1),
            SD = sd(p1),
            p5 = quantile(p1, 0.05),
            p95 = quantile(p1, 0.95),
            )%>%knitr::kable(digits = 3)
```
Theo k·∫øt qu·∫£ n√†y, m·∫∑c d√π gi√° tr·ªã trung b√¨nh c·ªßa t·ª∑ l·ªá t·∫°o blastocyte c√≥ v·∫ª cao h∆°n ·ªü nh√≥m d (dual trigger), nh∆∞ng gi·ªõi h·∫°n ph√¢n b·ªë c·ªßa t·ª∑ l·ªá n√†y l·∫°i kh√¥ng cho th·∫•y s·ª± kh√°c bi·ªát gi·ªØa 3 nh√≥m.

Ti·∫øp theo, ta s·∫Ω so s√°nh tr·ª±c quan ƒë·∫∑c t√≠nh ph√¢n ph·ªëi c·ªßa s·ªë l∆∞·ª£ng blastocytes (b·∫±ng bi·ªÉu ƒë·ªì t·∫ßn su·∫•t - histogram) v√† t·ª∑ l·ªá blastocyte (b·∫±ng bi·ªÉu ƒë·ªì boxplot).

H√¨nh: Ph√¢n b·ªë c·ªßa s·ªë l∆∞·ª£ng blastocytes gi·ªØa 3 nh√≥m k·ªπ thu·∫≠t trigger

```{r}
pals = c("d" = "#fc035e", 
         "h" = "#b814ff", 
         "a" = "#fcb103")


df %>% ggplot(aes(x = blast, 
                      y = Trigger, 
                      fill= Trigger)) + 
  geom_density_ridges(stat = "binline", 
                      scale = 1, 
                      bins = 50,
                      alpha = 0.7,
                      draw_baseline = FALSE) +
  labs(x="Number of Blastocytes", y = "Trigger type") + 
  scale_fill_manual(values = pals, name = "Trigger") +
  scale_x_continuous(breaks = seq(0,30,5))+
  coord_flip() +
  theme_bw(10) +
  geom_vline(xintercept = median(df$blast),
             linetype=2,
             col="blue")+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  theme(axis.text = element_text(size = 10, color = "black"),
        axis.title = element_text(size = 10, color = "black"))
```

Ch√∫ th√≠ch: 3 bi·ªÉu ƒë·ªì t·∫ßn su·∫•t trong h√¨nh tr√¨nh b√†y ph√¢n b·ªë c·ªßa s·ªë l∆∞·ª£ng blastocytes (tr·ª•c Y) ·ªü 3 nh√≥m k·ªπ thu·∫≠t trigger (tr·ª•c X).

H√¨nh: Ph√¢n b·ªë c·ªßa t·ª∑ l·ªá t·∫°o blastocytes t·ª´ s·ªë no√£n ban ƒë·∫ßu gi·ªØa 3 nh√≥m

```{r}
df %>% ggplot(aes(y = p1, 
                      x = Trigger, 
                      fill= Trigger)) + 
  geom_boxplot(alpha = 0.7) +
  labs(y="Blastocyte formation rate", x = "Trigger type") + 
  scale_fill_manual(values = pals, name = "Trigger") +
  scale_y_continuous(breaks = seq(0,1,0.2))+
  coord_flip() +
  theme_bw(10) +
  geom_vline(xintercept = median(df$p1),
             linetype=2,
             col="blue")+
  theme(axis.text = element_text(size = 10, color = "black"),
        axis.title = element_text(size = 10, color = "black"))
```

Ch√∫ th√≠ch: 3 bi·ªÉu ƒë·ªì boxplot n√†y tr√¨nh b√†y trung v·ªã, ph√¢n v·ªã th·ª© 25 v√† 75 c·ªßa t·ª∑ l·ªá t·∫°o blastocytes (tr·ª•c X).Nh·ªØng ƒëi·ªÉm tr√≤n t∆∞∆°ng ·ª©ng v·ªõi c√°c gi√° tr·ªã v∆∞·ª£t xa kh·ªèi ph√¢n v·ªã th·ª© 95. 

## D·ª±ng m√¥ h√¨nh h·ªìi quy GLM Binomial

Hi·ªán th·ªùi, k·∫øt c·ª•c m√† ta quan t√¢m l√† s·ªë l∆∞·ª£ng $k$ blastocytes thu ƒë∆∞·ª£c sau qu√° tr√¨nh th·ª• tinh t·ª´ t·∫≠p h·ª£p $n$ no√£n ban ƒë·∫ßu, v√† t·ª∑ l·ªá $p = k/n$. Ta th·∫•y b√†i to√°n n√†y t∆∞∆°ng ƒë·ªìng v·ªõi ƒë·ªãnh nghƒ©a v·ªÅ quy lu·∫≠t ph√¢n ph·ªëi x√°c su·∫•t Binomial. 

Th·ª±c v·∫≠y, ph√¢n ph·ªëi Binomial (nh·ªã th·ª©c) cho ph√©p ∆∞·ªõc l∆∞·ª£ng gi√° tr·ªã c·ªßa m·ªôt bi·∫øn ng·∫´u nhi√™n $Y$, v·ªõi √Ω nghƒ©a $Y$ l√† s·ªë l·∫ßn thu ƒë∆∞·ª£c k·∫øt qu·∫£ th√†nh c√¥ng t·ª´ $n$ l∆∞·ª£t th·ª≠ nghi·ªám ƒë·ªôc l·∫≠p, bi·∫øt r·∫±ng m·ªói th·ª≠ nghi·ªám c√≥ x√°c su·∫•t th√†nh c√¥ng l√† $p$.

$$Y \sim B(n,p)$$
X√°c su·∫•t $Y$ nh·∫≠n m·ªôt gi√° tr·ªã = k ƒë∆∞·ª£c ∆∞·ªõc t√≠nh b·ªüi h√†m:

$$Pr(Y=k|n,p) = \binom{n}{k}p^{k}(1-p)^{n-k} = \frac{n!}{k!(n-k)!}p^{k}(1-p)^{n-k}$$

V·ªõi c√°c tham s·ªë c√≥ √Ω nghƒ©a nh∆∞ sau:

$k$ l√† s·ªë k·∫øt qu·∫£ th√†nh c√¥ng (·ªü ƒë√¢y l√† s·ªë l∆∞·ª£ng blastocyte t·∫°o th√†nh)

$n$ ch·ªâ s·ªë l∆∞·ª£t th·ª≠ nghi·ªám (·ªü ƒë√¢y l√† s·ªë no√£n ƒë∆∞·ª£c mang ƒëi th·ª• tinh)

$n \in \left\{0,1,2...\right\}$ 

$p$ l√† x√°c su·∫•t th√†nh c√¥ng c·ªßa m·ªôt th·ª≠ nghi·ªám (x√°c su·∫•t t·∫°o ƒë∆∞·ª£c blastocyte cho m·ªói no√£n)

$p \in \left [ 0,1\right ]$

$(1-p)$ l√† x√°c su·∫•t c·ªßa k·∫øt qu·∫£ ƒë·ªëi ngh·ªãch (th·∫•t b·∫°i, kh√¥ng t·∫°o ƒë∆∞·ª£c blastocyte)

Trong th∆∞ vi·ªán gamlss[@gamlss1], ph√¢n ph·ªëi Binomial cho m√¥ h√¨nh GLM[@rigby2020] ƒë∆∞·ª£c x√°c ƒë·ªãnh b·ªüi 2 tham s·ªë $n$ v√† $\mu$, k√≠ hi·ªáu $BI(n,\mu)$, cho ph√©p ∆∞·ªõc l∆∞·ª£ng gi√° tr·ªã c·ªßa m·ªôt bi·∫øn ng·∫´u nhi√™n $Y$ c√≥ b·∫£n ch·∫•t l√† s·ªë ƒë·∫øm v·ªõi $Y \in \left [ 0,1,2,3...\right ]$ v·ªõi h√†m x√°c su·∫•t:

$$Pr(Y=y|n,\mu) = \frac{n!}{y!(n-y)!}\mu^{y}(1-p)^{n-y}$$
Trong ƒë√≥ $n$ l√† m·ªôt s·ªë nguy√™n d∆∞∆°ng ƒë√£ x√°c ƒë·ªãnh (trong tr∆∞·ªùng h·ª£p n√†y, $n$ = s·ªë no√£n cho m·ªói b·ªánh nh√¢n), tham s·ªë $\mu = \frac{k}{n}$ l√† x√°c su·∫•t trung b√¨nh thu ƒë∆∞·ª£c blastocyte t·ª´ 1 no√£n ($0< \mu < 1$). Ta c√≥ th·ªÉ ∆∞·ªõc l∆∞·ª£ng gi√° tr·ªã c·ªßa $\mu$ b·∫±ng m·ªôt m√¥ h√¨nh tuy·∫øn t√≠nh t·ªïng qu√°t v·ªõi h√†m li√™n k·∫øt logit:

$$log‚Å°it(\mu)=log(\frac{\mu}{1-\mu}) = \beta_0+ùõΩ_1 ùëã_1+ùõΩ_2 ùëã_2+ ‚Ä¶ +ùõΩ_ùëó ùëã_ùëó$$
Ta s·∫Ω d√πng m√¥ h√¨nh n√†y ƒë·ªÉ suy di·ªÖn th·ªëng k√™ v·ªÅ hi·ªáu ·ª©ng c·ªßa k·ªπ thu·∫≠t dual trigger tr√™n t·ª∑ l·ªá t·∫°o blastocytes.

ƒê·ªÉ d·ª±ng m√¥ h√¨nh binomial, ta d√πng h√†m gamlss c·ªßa th∆∞ vi·ªán gamlss, v·ªõi m·ªôt s·ªë l∆∞u √Ω nh∆∞ sau:

+ C√¥ng th·ª©c c·ªßa m√¥ h√¨nh h·ªìi quy binomial kh√°c v·ªõi c√°c m√¥ h√¨nh th√¥ng th∆∞·ªùng, v√¨ ·ªü v·ªã tr√≠ k·∫øt qu·∫£ y, ta c·∫ßn k·∫øt h·ª£p 2 bi·∫øn: s·ªë l∆∞·ª£ng th√†nh c√¥ng (blast) v√† s·ªë l∆∞·ª£ng th·∫•t b·∫°i (oocytes - blast), b·∫±ng h√†m cbind

+ T√πy ch·ªânh family = BI(mu.link = "logit")

Trong m√¥ h√¨nh hi·ªán th·ªùi, bi·∫øn ƒë·ªôc l·∫≠p l√† Trigger, ta cho n√≥ t∆∞∆°ng t√°c v·ªõi 2 hi·ªáp bi·∫øn kh√°c l√† Age v√† AFC:

"cbind(blast, oocytes-blast) ~  Trigger * (Age + AFC)"

N·ªôi dung k·∫øt qu·∫£ th√¥ c·ªßa m√¥ h√¨nh nh∆∞ sau
```{r}
bi_mod = gamlss(cbind(blast, oocytes-blast) ~ 
               Trigger * (Age + AFC),
             data = df,
             family = BI(mu.link = "logit"))

summary(bi_mod)
```

L∆∞u √Ω r·∫±ng m√¥ h√¨nh n√†y ∆∞·ªõc l∆∞·ª£ng gi√° tr·ªã c·ªßa $\mu$ l√† 1 x√°c su·∫•t (hay t·ª∑ l·ªá) v√† s·ª≠ d·ª•ng h√†m li√™n k·∫øt l√† logit, v√¨ v·∫≠y c√°c h·ªá s·ªë h·ªìi quy m√† ta th·∫•y ƒëang ·ªü thang ƒëo $log(Odds)$, v·ªõi odds l√† t·ªâ l·ªá gi·ªØa 2 x√°c su·∫•t $\frac{\mu}{1-\mu}$, ta c√≥ th·ªÉ chuy·ªÉn v·ªÅ thang ƒëo odds b·∫±ng h√†m exponential, ho·∫∑c chuy·ªÉn h·∫≥n v·ªÅ x√°c xu·∫•t $\mu$ b·∫±ng h√†m plogis.

h·ªá s·ªë (Intercept) t∆∞∆°ng ·ª©ng v·ªõi $log(\mu/(1-\mu))$ khi k·ªπ thu·∫≠t trigger l√† Agonist (nh√≥m tham chi·∫øu), v√† Age, AFC ·ªü v·ªã tr√≠ trung b√¨nh c·ªßa qu·∫ßn th·ªÉ.

√Åp d·ª•ng h√†m plogis cho intercept, ta s·∫Ω c√≥ gi√° tr·ªã trung b√¨nh c·ªßa t·ª∑ l·ªá blastocyte ·ªü ph√¢n nh√≥m Agonist = 0.257 ·ªü ƒëi·ªÅu ki·ªán Age = 30.55 v√† AFC = 16.24

```{r}
plogis(-1.0593442)
```

Triggerd v√† Triggerh t∆∞∆°ng ·ª©ng v·ªõi gi√° tr·ªã log(odds) tƒÉng th√™m ·ªü 2 nh√≥m Dual trigger v√† hCG so v·ªõi nh√≥m tham chi·∫øu Agonist (trong ƒëi·ªÅu ki·ªán AFC v√† Age kh√¥ng ƒë·ªïi).

·ªû ƒë√¢y ta quan t√¢m ƒë·∫øn nh√≥m Dual trigger, h·ªá s·ªë h·ªìi quy c·ªßa n√≥ = 0.3033475, gi√° tr·ªã n√†y > 0 n√™n ta c√≥ th·ªÉ ∆∞·ªõc l∆∞·ª£ng l√† nh√≥m Dual trigger c√≥ kh·∫£ nƒÉng t·∫°o blastocytes cao h∆°n so v·ªõi nh√≥m tham chi·∫øu Agonist; 

√Åp d·ª•ng h√†m plogis ta c√≥ th·ªÉ ∆∞·ªõc t√≠nh t·ª∑ l·ªá t·∫°o blastocyte trung b√¨nh ·ªü nh√≥m Dual trigger = 0.32

```{r}
plogis(-1.0593442 + 0.3033475)
```

Tuy nhi√™n, ƒë·ªÉ suy di·ªÖn th·ªëng k√™ m·ªôt c√°ch d·ªÖ d√†ng h∆°n, ta s·∫Ω ti·∫øn h√†nh quy tr√¨nh ∆∞·ªõc t√≠nh marginal effects nh∆∞ sau ƒë√¢y.

## Suy di·ªÖn th·ªëng k√™

ƒê·∫ßu ti√™n, √°p d·ª•ng h√†m avg_comparisons, ta c√≥ th·ªÉ ∆∞·ªõc t√≠nh ƒë∆∞·ª£c kh√°c bi·ªát v·ªÅ x√°c su·∫•t t·∫°o blastocytes trung b√¨nh gi·ªØa 2 k·ªπ thu·∫≠t: A so v·ªõi D, A so v·ªõi H v√† D so v·ªõi H.

```{r}
dif_p = avg_comparisons(
  bi_mod,
  what = "mu",
  variables = list(Trigger = 'pairwise'))%>%
  dplyr::select(-c(1,6))

dif_p %>% knitr::kable(digits = 3)
```

Theo k·∫øt qu·∫£ n√†y, c·∫£ 3 c·∫∑p so s√°nh ƒë·ªÅu kh√¥ng c√≥ √Ω nghƒ©a th·ªëng k√™ (p value > 0.05 v√† KTC95% ch·ª©a gi√° tr·ªã 0). 

Ta c≈©ng c√≥ th·ªÉ ∆∞·ªõc t√≠nh hi·ªáu ·ª©ng c·ªßa D so v·ªõi A v√† H th√¥ng qua tr·ªã s·ªë Odds-ratio b·∫±ng c√°ch √°p d·ª•ng 2 h√†m transform_pre = "lnoravg" v√† post = exp.

```{r}
or = avg_comparisons(
  bi_mod,
  what = "mu",
  variables = list(Trigger = 'pairwise'),
  transform_pre = "lnoravg",
  transform_post = "exp")%>%
  dplyr::select(-c(1))

or %>% mutate(contrast = 'OR')%>%
  knitr::kable(digits = 3)
```

Theo k·∫øt qu·∫£ n√†y, n·∫øu ch·ªçn nh√≥m Agonist l√†m tham chi·∫øu, OR c·ªßa Dual trigger = 1.016, tuy nhi√™n KTC95% ch·ª©a gi√° tr·ªã 1 v√† p value > 0.05, n√™n kh√¥ng c√≥ √Ω nghƒ©a th·ªëng k√™.

T∆∞∆°ng t·ª±, OR c·ªßa nh√≥m hCG so v·ªõi Dual trigger = 0.96 < 1, tuy nhi√™n c≈©ng kh√¥ng c√≥ √Ω nghƒ©a th·ªëng k√™.


Ta c√≤n c√≥ th·ªÉ ∆∞·ªõc t√≠nh hi·ªáu ·ª©ng b·∫±ng Risk-ratio (RR), ch·ªâ c·∫ßn thay h√†m transform_pre = "lnratioavg".

```{r}
rr = avg_comparisons(
  bi_mod,
  what = "mu",
  variables = list(Trigger = 'pairwise'),
  transform_pre = "lnratioavg",
  transform_post = exp)%>%
  dplyr::select(-c(1))

rr %>%mutate(contrast = 'RR')%>%
  knitr::kable(digits = 3)
```

Ta di·ªÖn gi·∫£i k·∫øt qu·∫£ RR t∆∞∆°ng t·ª± nh∆∞ tr√™n, kh√¥ng c√≥ s·ª± kh√°c bi·ªát gi·ªØa Dual trigger v√† nh√≥m tham chi·∫øu Agonist ho·∫∑c hCG.

Ngo√†i ra, ta c√≥ th·ªÉ ƒëi xa h∆°n khi ∆∞·ªõc l∆∞·ª£ng hi·ªáu ·ª©ng (OR ho·∫∑c RR) c·ªßa Dual trigger trong nh·ªØng ƒëi·ªÅu ki·ªán kh√°c nhau c·ªßa hi·ªáp bi·∫øn, th√≠ d·ª• AFC = 2,5,10 v√† 20 nh∆∞ sau:

```{r}
or = avg_comparisons(
  bi_mod,
  what = "mu",
  by = "AFC",
  variables = list(Trigger = 'pairwise'),
  newdata = datagrid(AFC = c(2,5,10,20),
                     grid_type = 'counterfactual'),
  transform_pre = "lnoravg",
  transform_post = "exp")

or %>% mutate(contrast = 'OR')%>%
  knitr::kable(digits = 3)
```

K·∫øt qu·∫£ n√†y kh√° th√∫ v·ªã, v√¨ n√≥ cho th·∫•y r·∫±ng khi AFC <= 5, OR c·ªßa Dual trigger so v·ªõi Agonist l·∫ßn l∆∞·ª£t l√† 1.27 v√† 1.21 v√† c√≥ √Ω nghƒ©a th·ªëng k√™. 

Ta c√≥ th·ªÉ tr√¨nh b√†y tr·ª±c quan v·ªÅ hi·ªáu ·ª©ng c·ªßa k·ªπ thu·∫≠t trigger ƒë·ªëi v·ªõi t·ª∑ l·ªá t·∫°o blastocyte, d·ª±a v√†o m√¥ h√¨nh Binomial nh∆∞ sau:

```{r}
preds = predictions(bi_mod, 
                    what = "mu", 
                    newdata = datagrid(Trigger = c('d','a','h'),
                                       grid_type = "counterfactual"),
                    new_data = df)

preds%>%ggplot()+
  stat_halfeye(alpha = 0.4, 
               aes(x = Trigger, 
                   y = estimate,
                   fill = Trigger),
               .width = c(0.75, 0.95),
               point_interval = 'median_qi',
               show.legend = T)+
  stat_lineribbon(aes(y = estimate, 
                      x = Trigger), 
                  fill = 'gold',
                  .width = c(.95, .75, .50), 
                  alpha = 1/8,
                  show.legend = F) +
  labs(y="Rate of blastocytes", 
       x = "Trigger") + 
  scale_fill_manual(values = pals, 
                    name = "Trigger")+
  scale_y_continuous(breaks = c(seq(0,0.4,0.05)))+
  theme_bw()
```

Ta c√≥ th·ªÉ tr√¨nh b√†y c√πng k·∫øt qu·∫£ tr√™n nh∆∞ng cho ri√™ng 6 ƒëi·ªÅu ki·ªán kh√°c nhau v·ªÅ gi√° tr·ªã AFC = 1,5,10,15,20 v√† 30

```{r}
preds = predictions(model = bi_mod,
                    what = "mu",
                    newdata = datagrid(AFC = c(1,5,10,15,20,30),
                                       grid_type = "counterfactual"))

preds%>%ggplot()+
  stat_halfeye(alpha = 0.4, 
               aes(x = Trigger, 
                   y = estimate,
                   fill = Trigger),
               .width = c(0.75, 0.95),
               point_interval = 'median_qi',
               show.legend = T)+
  stat_lineribbon(aes(y = estimate, x = Trigger), 
                  fill = 'gold',
                  .width = c(.95, .75, .50), 
                  alpha = 1/8,
                  show.legend = F) +
  labs(y="Rate of blastocytes", x = "Trigger") + 
  scale_fill_manual(values = pals, name = "Trigger")+
  facet_wrap(~AFC, scales = "free")+
  theme_bw()
```

**Di·ªÖn gi·∫£i k·∫øt qu·∫£ c·ªßa ph√¢n t√≠ch** : K·∫øt qu·∫£ ph√¢n t√≠ch h·ªìi quy cho th·∫•y ·ªü c·∫•p ƒë·ªô qu·∫ßn th·ªÉ, k·ªπ thu·∫≠t dual trigger c√≥ hi·ªáu qu·∫£ t∆∞∆°ng ƒë∆∞∆°ng v·ªõi 2 k√Ω thu·∫≠t GnRH agonist v√† hCG v·ªÅ t·ª∑ l·ªá t·∫°o blastocytes. Tuy nhi√™n, ·ªü nh·ªØng ƒë·ªëi t∆∞·ª£ng c√≥ AFC <5, hi·ªáu qu·∫£ t·∫°o blastocyte c·ªßa Dual trigger cao h∆°n m·ªôt c√°ch c√≥ √Ω nghƒ©a so v·ªõi GnRH agonist (OR = 1.27, KTC95%: 1.05 - 1.54, p=0.01).

## Th√¥ng ƒëi·ªáp r√∫t g·ªçn l√†m h√†nh trang

(1) Chu·ªói k·∫øt qu·∫£ trong ti·∫øn tr√¨nh th·ª• tinh ·ªëng nghi·ªám c√≥ t√≠nh ch·∫•t k·∫ø th·ª´a. Th√†nh qu·∫£ c·ªßa c√¥ng ƒëo·∫°n sau (th√≠ d·ª• s·ªë ph√¥i) c√≥ th·ªÉ ƒë∆∞·ª£c kh·∫£o s√°t nh∆∞ t·ª∑ l·ªá th√†nh c√¥ng t·ª´ nhi·ªÅu l·∫ßn th·ª≠ nghi·ªám tr√™n t·∫≠p h·ª£p c√°c ƒë∆°n v·ªã no√£n. Hi·ªán t∆∞·ª£ng n√†y t∆∞∆°ng ƒë·ªìng v·ªõi √Ω nghƒ©a c·ªßa quy lu·∫≠t ph√¢n ph·ªëi nh·ªã th·ª©c.

(2) V√¨ v·∫≠y, m√¥ h√¨nh tuy·∫øn t√≠nh t·ªïng qu√°t v·ªõi ph√¢n ph·ªëi nh·ªã th·ª©c c√≥ th·ªÉ d√πng nh∆∞ c√¥ng c·ª• trung gian l√Ω t∆∞·ªüng ƒë·ªÉ th·ª±c hi·ªán suy di·ªÖn th·ªëng k√™ cho k·∫øt qu·∫£ l√† t·ª∑ l·ªá (nh∆∞ t·ª∑ l·ªá tr∆∞·ªüng th√†nh no√£n, t·ª∑ l·ªá t·∫°o ph√¥i...)

(3) Ta suy di·ªÖn th·ªëng k√™ cho k·∫øt c·ª•c t·ª∑ l·ªá d·ª±a v√†o t·ª∑ s·ªë OR ho·∫∑c RR hi·ªáu ch·ªânh t·ª´ m√¥ h√¨nh GLM Binomial.
